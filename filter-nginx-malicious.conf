# up-cp-nginx-malicious filter
# Blocks malformed and malicious access attempts based on common patterns

[Definition]

failregex = 

    # Match hex-encoded binary payloads, often used in probes or exploit attempts, resulting in a 4XX Request
    ^<HOST> - - \[.*\] "\\x[0-9a-fA-F]{2}.*" 4\d{2} .*

    # Match suspicious query parameters like ?time=1234567890123
    ^<HOST> - - \[.*\] ".*\?(time|id|token)=\d{10,}" 4\d{2} .*

    # Block common bad endpoints used in scans and exploits
    ^<HOST> - - \[.*\] "(GET|POST) /.*(api/bin|config/index|wp-login|wp-config|wp-login|phpmyadmin|adminer|env|shell|\.git|\.env|\.DS_Store|wlwmanifest\.xml).*" 4\d{2} .*

    # Block empty User-Agents â€” often a sign of botnets or scanners
    ^<HOST> - - \[.*\] ".*" \d+ \d+ "-" "-"$

    # Block specific known-bad user agents
    ^<HOST> - - \[.*\] ".*" \d+ \d+ "-" ".*(Go-http-client|scanner|libwww-perl|masscan).*"

    # Block HTTP/1.0 requests, often used by outdated scanners
    ^<HOST> - - \[.*\] ".* HTTP/1\.0" \d+ .*

    # Attempts to access hidden files (dotfiles like .htaccess, .git/config, etc.)
    ^<HOST> - - \[.*\] "(GET|POST) /.*/\.[\w\-.]+.*" 4\d{2} .*

    # Block attempts to access wp-admin/setup-config.php resulting in 404
    ^<HOST> - - \[.*\] "(GET|POST) .*/wp-admin/setup-config\.php" 404 .*

# No ignore patterns needed
ignoreregex =